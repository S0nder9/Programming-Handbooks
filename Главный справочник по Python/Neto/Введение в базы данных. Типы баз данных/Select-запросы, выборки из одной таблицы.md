# Основы манипуляции данными в SQL

Этот документ описывает основные операции для работы с данными в реляционных базах данных с использованием SQL: вставка, выборка, обновление и удаление данных, а также расширенные возможности `SELECT`-запросов.

---

## Основные операции с данными (DML)

### 1. Вставка данных (`INSERT`)

Добавляет новые записи в таблицу.

**Синтаксис 1: Указание столбцов**
```sql
INSERT INTO table_name (column1, column2)
VALUES (value1, value2);
```

**Синтаксис 2: Без указания столбцов** (значения должны соответствовать порядку столбцов в таблице)
```sql
INSERT INTO table_name
VALUES (value1, value2);
```

**Пример:**
```sql
INSERT INTO student (name, description)
VALUES ('Alice', 'Computer Science major');

INSERT INTO student
VALUES ('Bob', 'Mathematics enthusiast');
```

**Пояснение:**
- В первом случае указаны столбцы `name` и `description`.
- Во втором случае значения вставляются в порядке определения столбцов в таблице.
- Если в таблице есть автоинкрементируемый столбец (например, `id SERIAL`), его можно опустить при вставке.

---

### 2. Выборка данных (`SELECT`)

Извлекает данные из таблицы.

**Пример:**
```sql
SELECT * FROM student;
```

**Пояснение:** Выбирает все столбцы и строки из таблицы `student`.

---

### 3. Обновление данных (`UPDATE`)

Изменяет существующие записи в таблице.

**Синтаксис:**
```sql
UPDATE table_name
SET column1 = value1, column2 = value2
WHERE condition;
```

**Пример:**
```sql
UPDATE student
SET name = 'Alice Smith'
WHERE id = 1;
```

**Пояснение:**
- Обновляет поле `name` для записи с `id = 1`.
- Условие `WHERE` обязательно, чтобы избежать изменения всех строк.

---

### 4. Удаление данных (`DELETE`)

Удаляет записи из таблицы.

**Синтаксис:**
```sql
DELETE FROM table_name
WHERE condition;
```

**Пример:**
```sql
DELETE FROM student
WHERE id = 1;
```

**Пояснение:**
- Удаляет запись с `id = 1`.
- Без `WHERE` удалятся все строки в таблице.

---

## Расширенные возможности `SELECT`-запросов

`SELECT` — наиболее мощная команда SQL, позволяющая гибко извлекать данные с фильтрацией, сортировкой и другими операциями.

### 1. Базовые примеры

- **Выбор всех данных:**
  ```sql
  SELECT * FROM film;
  ```

- **Выбор конкретных столбцов:**
  ```sql
  SELECT title FROM film;
  SELECT title, release_year FROM film;
  ```

- **Выбор уникальных значений:**
  ```sql
  SELECT DISTINCT rating FROM film;
  ```

- **Арифметические операции:**
  ```sql
  SELECT amount * 85 FROM payment;
  ```

**Пояснение:**
- `DISTINCT` убирает дубликаты из результата.
- В `SELECT` можно выполнять вычисления над данными.

---

### 2. Фильтрация данных (`WHERE`)

Условие `WHERE` позволяет выбирать строки, удовлетворяющие заданным критериям.

**Пример:**
```sql
SELECT release_year FROM film
WHERE release_year >= 2000;
```

**Дополнительные операторы:**
- **Логические условия (`AND`, `OR`):**
  ```sql
  SELECT title, release_year FROM film
  WHERE release_year >= 2000 AND rating = 'PG';
  ```

- **Диапазоны (`IN`, `BETWEEN`):**
  ```sql
  SELECT title FROM film
  WHERE release_year IN (2000, 2005, 2010);
  ```
  ```sql
  SELECT title FROM film
  WHERE release_year BETWEEN 2000 AND 2010;
  ```

- **Поиск по шаблону (`LIKE`):**
  ```sql
  SELECT title FROM film
  WHERE title LIKE '%text%'; -- ищет строки, содержащие "text"
  ```
  ```sql
  SELECT title FROM film
  WHERE title LIKE '_text_'; -- ищет строки с одним символом до и после "text"
  ```

**Пояснение:**
- `%` — любое количество символов.
- `_` — ровно один символ.

---

### 3. Сортировка (`ORDER BY`)

Сортирует результат запроса по одному или нескольким столбцам.

**Пример:**
```sql
SELECT rating FROM film
ORDER BY rating; -- по возрастанию (по умолчанию)
```
```sql
SELECT rating FROM film
ORDER BY rating DESC; -- по убыванию
```

**Пояснение:**
- `ASC` (по возрастанию) используется по умолчанию.
- `DESC` указывает сортировку по убыванию.

---

### 4. Ограничение вывода (`LIMIT`)

Ограничивает количество возвращаемых строк.

**Пример:**
```sql
SELECT DISTINCT rating FROM film
LIMIT 10;
```

**Пояснение:** Возвращает только первые 10 уникальных значений столбца `rating`.

---

## Рекомендации по написанию запросов

1. **Читаемость:**
   - Форматируйте запросы с отступами для удобства чтения.
   - Используйте заглавные буквы для ключевых слов SQL (например, `SELECT`, `WHERE`).

2. **Безопасность:**
   - Всегда используйте `WHERE` в `UPDATE` и `DELETE`, чтобы избежать случайного изменения или удаления всех данных.
   - При работе с пользовательским вводом используйте параметризованные запросы для защиты от SQL-инъекций.

3. **Оптимизация:**
   - Выбирайте только необходимые столбцы вместо `*` в `SELECT`, чтобы уменьшить нагрузку.
   - Используйте `DISTINCT` и `LIMIT` для сокращения объема данных.

4. **Тестирование:**
   - Перед выполнением `UPDATE` или `DELETE` проверяйте выборку с помощью `SELECT`:
     ```sql
     SELECT * FROM student WHERE id = 1;
     ```