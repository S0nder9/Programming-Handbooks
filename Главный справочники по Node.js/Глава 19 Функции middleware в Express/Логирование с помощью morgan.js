// Глава 19: Функции middleware в Express - Логирование с помощью morgan в Node.js

// Middleware-функции в Express - это функции, которые выполняются во время обработки запроса.
// Они имеют доступ к объектам запроса (req), ответа (res) и функции next для передачи управления следующей middleware-функции.
// Middleware используется для обработки различных задач, таких как аутентификация, управление сессиями, логирование и т.д.

// Логирование с помощью morgan:
// Morgan - это популярный middleware для логирования HTTP-запросов в приложениях Express.
// Он поддерживает различные форматы логов и позволяет легко интегрировать логирование в ваше приложение.

// Установка morgan:
// Для использования morgan необходимо сначала установить его с помощью npm:
npm install morgan

// Подключение morgan к приложению Express:
const express = require('express');
const morgan = require('morgan');
const app = express();

// Использование morgan для логирования всех HTTP-запросов в формате 'combined':
app.use(morgan('combined'));

// Формат 'combined' включает в себя следующие поля:
// - IP-адрес клиента
// - Дата и время запроса
// - HTTP-метод и URL
// - Статус ответа
// - Размер ответа в байтах
// - Время обработки запроса

// Пример маршрута:
app.get('/', (req, res) => {
  res.send('Hello, world!');
});

// Запуск сервера:
const PORT = 3000;
app.listen(PORT, () => {
  console.log(`Server is running on port ${PORT}`);
});

// Теперь каждый запрос к вашему приложению будет логироваться с использованием morgan.

// Дополнительные возможности morgan:
// Вы можете использовать различные предустановленные форматы логов или создать свой собственный формат.
// Вот несколько примеров предустановленных форматов:
// 'tiny' - минималистичный формат логов, содержащий только основной минимум информации.
// 'dev' - формат, предназначенный для разработки, выводит лог в цвете и содержит метод, URL и статус ответа.

// Использование формата 'tiny':
app.use(morgan('tiny'));

// Создание собственного формата логов:
morgan.format('myFormat', ':method :url :status :res[content-length] - :response-time ms');
app.use(morgan('myFormat'));

// Итог:
// Использование middleware для логирования запросов с помощью morgan позволяет легко отслеживать и анализировать запросы к вашему приложению.
// Это может помочь в отладке, мониторинге производительности и улучшении безопасности вашего приложения.
